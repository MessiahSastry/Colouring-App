<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jungle Coloring Page</title>
  <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="school-title">
    <h1>St. Patrick's School</h1>
    <h2>IIT & NEET FOUNDATION</h2>
  </div>

  <button id="toggleToolbar" class="toolbar-toggle">⇋</button>

  <div class="toolbar-wrapper" id="toolbar">
    <button id="brushBtn">✏️ Brush</button>
    <button id="eraserBtn">🧽 Eraser</button>
    <input type="range" id="brushSize" min="2" max="40" value="10">
    <input type="range" id="eraserSize" min="2" max="40" value="10">
    <button id="undoBtn">↩️ Undo</button>
    <button id="redoBtn">↪️ Redo</button>
    <button id="saveBtn">💾 Save</button>
    <button id="loadBtn">📥 Load</button>
    <button id="downloadBtn">📸 Download</button>
    <button id="uploadBtn">🖼️ Upload</button>
    <button id="fullscreenBtn">🌐 Full-Screen</button>
  </div>

  <div class="zoom-container">
    <canvas id="bgCanvas"></canvas>
    <canvas id="drawingCanvas"></canvas>
  </div>

  <audio id="bgMusic" loop autoplay muted>
    <source src="sounds/music.mp3" type="audio/mpeg">
  </audio>

  <script src="js/script.js"></script>

  <script>
    const bgCanvas = document.getElementById('bgCanvas');
    const canvas = document.getElementById('drawingCanvas');
    const bgCtx = bgCanvas.getContext('2d');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    const bgImage = new Image();
    bgImage.src = "images/Jungle.png";  // Image path for jungle page

    bgImage.onload = function() {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);  // Clear previous content
      bgCtx.drawImage(bgImage, 0, 0, bgCanvas.width, bgCanvas.height);  // Draw image on canvas
    };

    if (bgImage.complete) {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);  // Clear canvas
      bgCtx.drawImage(bgImage, 0, 0, bgCanvas.width, bgCanvas.height);  // Draw image
    }

    let isDrawing = false, isErasing = false, brushColor = "#ff0000", brushSize = 10, eraserSize = 10;
    
    document.getElementById('brushBtn').onclick = () => isErasing = false;
    document.getElementById('eraserBtn').onclick = () => isErasing = true;
    document.getElementById('brushSize').oninput = e => brushSize = e.target.value;
    document.getElementById('eraserSize').oninput = e => eraserSize = e.target.value;

    function saveState() {
      const data = canvas.toDataURL();
      localStorage.setItem(location.pathname, data);
    }

    function loadState() {
      const data = localStorage.getItem(location.pathname);
      if (data) {
        const img = new Image();
        img.src = data;
        img.onload = () => ctx.drawImage(img, 0, 0);
      }
    }

    document.getElementById('saveBtn').onclick = saveState;
    document.getElementById('loadBtn').onclick = loadState;

    document.getElementById('downloadBtn').onclick = () => {
      const link = document.createElement('a');
      link.download = 'drawing.png';
      link.href = canvas.toDataURL();
      link.click();
    };

    let history = [], historyStep = -1;

    document.getElementById('undoBtn').onclick = () => {
      if (historyStep > 0) {
        historyStep--;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0);
        img.src = history[historyStep];
      }
    };

    document.getElementById('redoBtn').onclick = () => {
      if (historyStep < history.length - 1) {
        historyStep++;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0);
        img.src = history[historyStep];
      }
    };

    canvas.addEventListener('mousedown', e => {
      isDrawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mousemove', e => {
      if (!isDrawing) return;
      ctx.lineWidth = isErasing ? eraserSize : brushSize;
      ctx.lineCap = "round";
      ctx.strokeStyle = isErasing ? "#ffffff" : brushColor;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    });

    canvas.addEventListener('mouseup', () => {
      isDrawing = false;
      saveState();
    });

    canvas.addEventListener('touchstart', e => {
      if (e.touches.length > 1) return;
      const t = e.touches[0];
      const touchX = t.clientX;
      const touchY = t.clientY;
      ctx.beginPath();
      ctx.moveTo(touchX, touchY);
      isDrawing = true;
    });

    canvas.addEventListener('touchmove', e => {
      if (e.touches.length > 1) return;
      if (!isDrawing) return;
      const t = e.touches[0];
      const touchX = t.clientX;
      const touchY = t.clientY;
      ctx.lineWidth = isErasing ? eraserSize : brushSize;
      ctx.lineCap = "round";
      ctx.strokeStyle = isErasing ? "#ffffff" : brushColor;
      ctx.lineTo(touchX, touchY);
      ctx.stroke();
      e.preventDefault();
    });

    canvas.addEventListener('touchend', () => {
      if (!isDrawing) return;
      isDrawing = false;
      saveState();
    });

    // Fullscreen toggle
    document.getElementById('fullscreenBtn').onclick = () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    };

    window.onload = () => saveState();
  </script>
</body>
</html>
